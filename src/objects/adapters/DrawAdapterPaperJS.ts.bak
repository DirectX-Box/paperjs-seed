import { DrawAdapterInterface } from "./DrawAdapterInterface";
import { PlanObject } from "../PlanObject";
import * as paper from "paper";

class DrawAdapterPaperJS implements DrawAdapterInterface
{
    private paperShapes: Map< PlanObject, paper.Shape >;

    public constructor()
    {
        this.paperShapes = new Map([]);
    }

    // Efface l'objet passé en paramètre.
    public deleteObject( object: PlanObject ) : void
    {
        let shape = this.paperShapes.get( object );
        if( shape )
        {
            shape.remove();
        }

        this.paperShapes.delete( object );
    }

    // Dessine l'objet passé en paramètre.
    public drawObject( object: PlanObject ) : void
    {
        let shapeToDraw = object.getShape();
        switch( shapeToDraw.getCount() )
        {
            case 1: {
                this.drawPoint( object );
                break;
            }
            case 2: {
                this.drawRectangle( object );
                break;
            }
        }
    }

    private drawPoint( object: PlanObject ) : void
    {
        let origin = object.getShape().getPoints();
        let shapeToDraw = new paper.Shape.Circle( origin );
        let shape = this.paperShapes.get( object );
        if( shape )
        {
            shape.replaceWith( shapeToDraw )
        }
        else
        {
            this.paperShapes.set( object, shapeToDraw );
        }
    }

    // Dessine un rectangle PaperJS.
    private drawRectangle( object: PlanObject ) : void
    {
        let points = object.getShape().getPoints();
        let p1 = new paper.Point( points[0].getX(), points[0].getY() );
        let p2 = new paper.Point( points[1].getX(), points[1].getY() );
        let shapeToDraw = new paper.Shape.Rectangle( p1, p2 )
        let shape = this.paperShapes.get( object );
        if( shape )
        {
            shape.replaceWith( shapeToDraw );
        }
        else
        {
            this.paperShapes.set( object, shapeToDraw );
        }
    }
}